<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Brummer Extension Test Page</title>
    <style>
        body {
            font-family: monospace;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
            background: #1e1e1e;
            color: #e0e0e0;
        }
        h1 { color: #FFD700; }
        .section {
            background: #2d2d2d;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 3px solid #FFD700;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            border-radius: 4px;
            font-family: monospace;
        }
        button:hover { background: #45a049; }
        .error { background: #f44336; }
        .error:hover { background: #da190b; }
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            padding: 10px;
            border-radius: 8px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üêù Brummer Extension Test Page</h1>
    
    <div class="section">
        <h2>Instructions</h2>
        <ol>
            <li>Open Firefox Developer Tools (F12)</li>
            <li>Click on the "üêù Brummer" tab</li>
            <li>Connect to your Brummer server (default: http://localhost:7777)</li>
            <li>Use the buttons below to test logging functionality</li>
        </ol>
    </div>
    
    <div class="section">
        <h2>Test Console Logging</h2>
        <button onclick="testLog()">console.log</button>
        <button onclick="testWarn()">console.warn</button>
        <button onclick="testError()" class="error">console.error</button>
        <button onclick="testInfo()">console.info</button>
        <button onclick="testDebug()">console.debug</button>
    </div>
    
    <div class="section">
        <h2>Test Errors</h2>
        <button onclick="throwError()" class="error">Throw JS Error</button>
        <button onclick="rejectPromise()" class="error">Promise Rejection</button>
        <button onclick="loadBadResource()" class="error">Resource Error</button>
    </div>
    
    <div class="section">
        <h2>Test Network</h2>
        <button onclick="testFetch()">Successful Fetch</button>
        <button onclick="testFetchError()" class="error">Failed Fetch</button>
        <button onclick="testXHR()">XMLHttpRequest</button>
    </div>
    
    <div class="section">
        <h2>URL Parameters Test</h2>
        <p>Current URL: <code id="currentUrl"></code></p>
        <button onclick="addBrummerParams()">Add Brummer Parameters</button>
        <button onclick="removeBrummerParams()">Remove Parameters</button>
    </div>
    
    <div class="section">
        <h2>Log Output</h2>
        <pre id="output">Test output will appear here...</pre>
    </div>
    
    <script>
        const output = document.getElementById('output');
        const currentUrl = document.getElementById('currentUrl');
        
        // Update current URL display
        function updateUrlDisplay() {
            currentUrl.textContent = window.location.href;
        }
        updateUrlDisplay();
        
        function log(msg) {
            const time = new Date().toLocaleTimeString();
            output.textContent += `[${time}] ${msg}\n`;
            console.log(`[Brummer Test] ${msg}`);
        }
        
        // Console tests
        function testLog() {
            const msg = 'This is a test console.log message';
            console.log(msg);
            log('‚úÖ Sent: console.log');
        }
        
        function testWarn() {
            const msg = 'This is a test warning message';
            console.warn(msg);
            log('‚ö†Ô∏è Sent: console.warn');
        }
        
        function testError() {
            const msg = 'This is a test error message';
            console.error(msg);
            log('‚ùå Sent: console.error');
        }
        
        function testInfo() {
            const msg = 'This is a test info message';
            console.info(msg);
            log('‚ÑπÔ∏è Sent: console.info');
        }
        
        function testDebug() {
            const msg = 'This is a test debug message';
            console.debug(msg);
            log('üîç Sent: console.debug');
        }
        
        // Error tests
        function throwError() {
            log('üí• Throwing JavaScript error...');
            setTimeout(() => {
                throw new Error('This is a test JavaScript error');
            }, 100);
        }
        
        function rejectPromise() {
            log('üî• Creating unhandled promise rejection...');
            Promise.reject('This is a test promise rejection');
        }
        
        function loadBadResource() {
            log('üì¶ Loading non-existent resource...');
            const img = document.createElement('img');
            img.src = 'http://invalid-domain-12345.test/image.png';
            document.body.appendChild(img);
            setTimeout(() => document.body.removeChild(img), 1000);
        }
        
        // Network tests
        async function testFetch() {
            log('üåê Making fetch request...');
            try {
                const response = await fetch('/test-endpoint');
                log(`‚úÖ Fetch completed: ${response.status} ${response.statusText}`);
            } catch (e) {
                log(`‚ùå Fetch failed: ${e.message}`);
            }
        }
        
        async function testFetchError() {
            log('üåê Making fetch request to invalid domain...');
            try {
                const response = await fetch('http://invalid-domain-12345.test/api');
                log(`‚úÖ Fetch completed: ${response.status}`);
            } catch (e) {
                log(`‚ùå Fetch failed: ${e.message}`);
            }
        }
        
        function testXHR() {
            log('üì° Making XMLHttpRequest...');
            const xhr = new XMLHttpRequest();
            xhr.open('GET', '/test-xhr');
            xhr.onload = () => log(`‚úÖ XHR completed: ${xhr.status}`);
            xhr.onerror = () => log('‚ùå XHR failed');
            xhr.send();
        }
        
        // URL parameter tests
        function addBrummerParams() {
            const url = new URL(window.location.href);
            url.searchParams.set('brummer_token', 'test_token_12345');
            url.searchParams.set('brummer_process', 'test_process');
            url.searchParams.set('brummer_base', 'http://localhost:7777');
            window.location.href = url.toString();
        }
        
        function removeBrummerParams() {
            const url = new URL(window.location.href);
            url.searchParams.delete('brummer_token');
            url.searchParams.delete('brummer_process');
            url.searchParams.delete('brummer_base');
            window.location.href = url.toString();
        }
        
        // Initial test
        log('üêù Brummer test page loaded');
        log('üìç Open DevTools and check the Brummer panel');
        
        // Check if we have Brummer parameters
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('brummer_token')) {
            log('‚úÖ Brummer parameters detected!');
            log(`   Token: ${urlParams.get('brummer_token')}`);
            log(`   Process: ${urlParams.get('brummer_process')}`);
            log('üîç Check browser console for enhanced logging');
        }
    </script>
</body>
</html>